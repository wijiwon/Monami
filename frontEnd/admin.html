<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<style>

  .tablee{
    width: 100%;
    border-collapse: collapse;
    text-align: center;
    /* border: solid 3px green; */
  }
  .tablee th{
    background-color: #4CAF50;
    color: white;
    padding: 15px;
  }
  .tablee td {
    border: 2px solid #dddddd;
    padding: 8px
  }
  .tablee tr:nth-child(even) {
  background-color: #e2f5d3;
  }

  .headerCelll,
  .celll{
    border: 2px solid #dddddd;
  }

  .tablee td:first-child {
    background-color:  #4CAF50;
}
/* Styling the button */
.approveBtn {
    background-color: #4CAF50; /* Green */
    border: none;
    color: white;
    padding: 10px 10px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
    transition-duration: 0.4s; /* Optional for smooth transition */
}

/* Changing the color on hover */
.approveBtn:hover {
    background-color: #45a049;
}
</style>
<body>

  <h1 class="noUser" id="noUser">회원가입 한 유저가 없습니다</h1>

  <div class="adminTableContainer" id="adminTableContainer">
    <table class="tablee">
      <tr class="headerRoww">
        <th class="headerCelll">헤더1</th>
        <th class="headerCelll">헤더2</th>
        <th class="headerCelll">헤더3</th>
        <th class="headerCelll">헤더4</th>
        <th class="headerCelll">헤더5</th>
      </tr>
      <tr class="roww">
        <td class="celll">td1</td>
        <td class="celll">td2</td>
        <td class="celll">td3</td>
        <td class="celll">td4</td>
        <td class="celll">
          <button class="approveBtn">승인</button>
        </td>
      </tr>
      <tr class="roww">
        <td class="celll">td1</td>
        <td class="celll">td2</td>
        <td class="celll">td3</td>
        <td class="celll">td4</td>
        <td class="celll">
          <button>승인</button>
        </td>
      </tr>

    </table>

  </div>

</body>
<script>
  // 데이터 가져오기

  // 테이블 그려주는 함수
  async function drawAdminTable() {
    try {
      await axios.get("/admin/hi", {
        withCredentials: true,
      }).then((e) => {
        // 유저 데이터 다 가져와서 (어드민 빼고) 그려준다
        console.log(e.data.users);
        const data = e.data.users
        if (data && data.length > 0) {
          noUser.style.display ="none"
          const tableContainer = document.getElementById("adminTableContainer");
          const table = document.createElement("table");
          const headerRow = document.createElement("tr");
          
          table.classList.add("tablee");
          headerRow.classList.add("headerRoww");

          // 헤더 부분 (tr,th)
          Object.keys(data[0]).forEach((key) => {
            const headerCell = document.createElement("th");
            headerCell.textContent = key;
            console.log(key);
            headerCell.classList.add("headerCelll");
            headerRow.appendChild(headerCell);
          });
          // 승인거절 헤더 추가
          const actionsHeaderCell = document.createElement("th");
          actionsHeaderCell.textContent = "승인";
          headerRow.appendChild(actionsHeaderCell);
          actionsHeaderCell.classList.add("actionsHeaderCell");
          // actionsHeaderCell 랑 똑같이 스타일주면됨
          table.appendChild(headerRow);
  
          // row (tr,td)
          data.forEach((item) => {
            const row = document.createElement("tr");
            row.classList.add("roww");
            // 값만 뽑기
            Object.values(item).forEach((value) => {
              const cell = document.createElement("td");
              cell.textContent = value;
              cell.classList.add("celll");
              row.appendChild(cell);
            });
  
            // 승인 부분 row
            const approveButton = document.createElement("button");
            approveButton.textContent = "승인";
            approveButton.classList.add("approveBtn");
            approveButton.addEventListener("click", () => {
              try {
                console.log("승인:", item);
                axios.post("/admin",{
                  // req.body.data 로 승인 거절 누른 사람 정보 전송해줌
                  data:
                  {
                    user_info : item
                  }
                }).then((e)=>{
                  console.log("승인ee",e);
                  if (status == 200) {
                    console.log("승인완료");
                  }
                })
                
              } catch (error) {
                console.log("수락 에러?",error);
              }
              window.location.reload();
            });
  
            // Create the actions cell and append the buttons
            const actionsCell = document.createElement("td");
            actionsCell.appendChild(approveButton);
            actionsCell.classList.add("actionsCell");
            // actionsCell.appendChild(rejectButton);
            row.appendChild(actionsCell);
  
            table.appendChild(row);
          });
  
          // Add the table to the container
          tableContainer.appendChild(table);
          
        }
      })
    } catch (error) {
      console.log("어드민 에러", error);
    }
  }

  // Call the function to draw the table
  drawAdminTable();

</script>

</html>