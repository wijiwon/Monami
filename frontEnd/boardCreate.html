<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- axios ë¡œ ì˜ˆì „ì— ì“°ë˜ form íƒœê·¸ ëŒ€ì‹  ì „ì†¡â­â­â­ -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

</head>
<body>


    <!-- ì œëª© -->
    <label for="">ì œëª©</label>
    <input type="text" id="title"> <br>

    <!-- ë³¸ë¬¸ -->
    <label for="">ë³¸ë¬¸</label> 
    <input type="text" id="content"> <br>

    <br>

    <!-- ì‚¬ì§„ -->
    <input type="file" id="post_img"> <br>


    <!-- ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸° âœ… -->
    <img id="post_img_pv" onerror="style.display='none'" alt="">
        <!-- [í•´ì„] 
                onerror="style.display='none'
                    1) imgì— ì´ë¯¸ì§€ê°€ ì—†ì„ë•Œ ë‚˜ì˜¤ëŠ” ì—‘ë°•ì„ ì•ˆë³´ì´ê²Œ í•´ì¤Œ 
                    2) ì—†ì–´ë„ ë˜ê¸´ í•˜ëŠ” ê²ƒ ê°™ì€ë°, ìš°ì„ , í•´ë†“ìŒ 
            -->
    <br>

    <!-- ê¸€ì“°ê¸° ë²„íŠ¼ -->
    <button id="writeBtn"> ê¸€ì“°ê¸° </button>

</body>


<script>

// ì „ì—­ë³€ìˆ˜ 
    let reader = new FileReader();


// ðŸ”¹ ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ 
    // 1. input íƒœê·¸ê°€ ë³€ê²½ë˜ë©´, profile í•¨ìˆ˜ ì‹¤í–‰í•´ì„œ, 1) ë³€í™˜ 2) ë³´ì—¬ì£¼ê¸° 
    post_img.addEventListener("click" , () => {
        post_img.onchange = (e) => {
            const filename = e.target.files[0];
            profile(filename);
        }
    })

    // 2. profile í•¨ìˆ˜ ì •ì˜
    const profile = (value) => {
        // reader.readAsDataURL(value) ë©”ì†Œë“œ ëë‚˜ë©´, ì‹¤í–‰ë¨
        reader.onload = () => {

            // readAsDataURL ë³€í™˜ê°’ì„ res ì— í• ë‹¹
            res = reader.result;
                // [í•´ì„]
                    // reader.result == reader.readAsDataURL(value)ì˜ ê²°ê³¼ê°’

            // ë¯¸ë¦¬ë³´ê¸° img íƒœê·¸ì— res ë„£ê¸°
            post_img_pv.setAttribute("src" , res);
                // [í•´ì„]
                    // ë¯¸ë¦¬ë³´ê¸° img íƒœê·¸ë¥¼ pv ë¡œ ê°€ì ¸ì˜¤ê³ , src ì†ì„±ì—, res í• ë‹¹
            
            // pv ë³´ì´ê²Œ í•˜ê¸° 
            post_img_pv.style.display = 'block'
                // [ì• ë§¤í•œ ê²ƒ]
                    // pv ê°€ ì´ì „ì—ëŠ” êº¼ì¡Œì—ˆë‚˜â“â“â“â“â“
        }
        // íŒŒì¼ ë§¤ê°œë³€ìˆ˜ë¥¼ ì½ì–´ì„œ -> base 64 ë¡œ ë³€í™˜
        reader.readAsDataURL(value);
            // [í•´ì„]
                // ì™„ë£Œë˜ë©´, reader.onload ê°€ ì‹¤í–‰ë¨
    }


    
// ê¸€ì“°ê¸° ë²„íŠ¼ í´ë¦­ì‹œ axios post ìš”ì²­ 
    writeBtn.onclick = () => {
        // form ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
        const form = new FormData();

        // form ê°ì²´ ì•ˆì— ë°ì´í„° append í•˜ê¸°
        form.append("title" , title.value);
        form.append("content" , content.value);
        form.append("post_img" , post_img.files[0]);

        console.log(title.value, content.value, post_img.files[0])

        // axios ì „ì†¡ 
        axios.post("http://127.0.0.1:8007/board/create" , form, { 
            // í—¤ë”ì˜ ë‚´ìš©ìœ¼ë¡œ, ì¸ì½”ë”©ëœ, í¼ ë°ì´í„°ë¡œ ì „ì†¡í•œë‹¤ê³  ì„¤ì •
            "Content-Type" : "multipart/form-data"
        }).then( (e) => {
            console.log("ðŸŽðŸŽðŸŽðŸŽðŸŽðŸŽ redirect ì°¾ê¸°" , e.data)
            console.log("ðŸŽðŸŽðŸŽðŸŽðŸŽðŸŽ redirect ì°¾ê¸°" , e.data.redirectURL)
            
            const redirectURL = e.data.redirectURL;
            window.location.href = redirectURL;

            // console.log("ìž˜ ì „ë‹¬ë¨ðŸ™Œ")
            // console.log(e.data)

        }).catch((err) => {
            console.log(err)
        })

    }







</script>


</html>