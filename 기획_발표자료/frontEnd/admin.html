<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
  <h1>어드민 페이지</h1>

  회원가입했을때 회원 정보들 불러와서
  테이블만들어주기
  foreach 로 회원 정보 그려주고
  수락 거절 만들고
  수락하면 숫자 1올려줌
  <h1 class="noUser" id="noUser">회원가입 한 유저가 없습니다</h1>
  <div id="adminTableContainer"></div>

</body>
<script>
  // 데이터 가져오기

  // 테이블 그려주는 함수
  async function drawAdminTable() {
    try {
      await axios.get("http://127.0.0.1:4000/admin", {
        withCredentials: true,
      }).then((e) => {
        // 유저 데이터 다 가져와서 (어드민 빼고) 그려준다
        console.log(e.data.users);
        const data = e.data.users
        if (data && data.length > 0) {
          noUser.style.display ="none"
          const tableContainer = document.getElementById("adminTableContainer");
          const table = document.createElement("table");
          const headerRow = document.createElement("tr");
  
          // 헤더 부분 (tr,th)
          Object.keys(data[0]).forEach((key) => {
            const headerCell = document.createElement("th");
            headerCell.textContent = key;
            console.log(key);
            headerRow.appendChild(headerCell);
          });
          // 승인거절 헤더 추가
          const actionsHeaderCell = document.createElement("th");
          actionsHeaderCell.textContent = "승인";
          headerRow.appendChild(actionsHeaderCell);
          table.appendChild(headerRow);
  
          // row (tr,td)
          data.forEach((item) => {
            const row = document.createElement("tr");
            // 값만 뽑기
            Object.values(item).forEach((value) => {
              const cell = document.createElement("td");
              cell.textContent = value;
              row.appendChild(cell);
            });
  
            // 승인 부분 row
            const approveButton = document.createElement("button");
            approveButton.textContent = "승인";
            approveButton.addEventListener("click", () => {
              try {
                console.log("승인:", item);
                axios.post("http://127.0.0.1:4000/admin",{
                  // req.body.data 로 승인 거절 누른 사람 정보 전송해줌
                  data:
                  {
                    user_info : item
                  }
                }).then((e)=>{
                  console.log("승인ee",e);
                  if (status == 200) {
                    console.log("승인완료");
                  }
                })
                
              } catch (error) {
                console.log("수락 에러?",error);
              }
              window.location.reload();
            });
  
            // // 거절 부분 row
            // const rejectButton = document.createElement("button");
            // rejectButton.textContent = "거절";
            // rejectButton.addEventListener("click", () => {
            //   console.log("거절:", item);
            // });
  
            // Create the actions cell and append the buttons
            const actionsCell = document.createElement("td");
            actionsCell.appendChild(approveButton);
            // actionsCell.appendChild(rejectButton);
            row.appendChild(actionsCell);
  
            table.appendChild(row);
          });
  
          // Add the table to the container
          tableContainer.appendChild(table);
          
        }
      })
    } catch (error) {
      console.log("어드민 에러", error);
    }
  }

  // Call the function to draw the table
  drawAdminTable();

</script>

</html>